<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background-color: #f4f6f9;
    padding: 2rem;
    color: #333;
  }

  .result-card {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    margin-bottom: 2.5rem;
    padding: 2rem;
    overflow-x: auto;
  }

  .section-title {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    color: #2c3e50;
    border-left: 5px solid #4b7bec;
    padding-left: 0.8rem;
  }

  .answer-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 700px;
  }

  .answer-table th,
  .answer-table td {
    border: 1px solid #e0e0e0;
    padding: 0.8em 1em;
    text-align: center;
  }

  .answer-table thead th {
    background-color: #f0f3f5;
    font-weight: 600;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  .answer-table td {
    background-color: #fff;
  }

  .answer-color-0 { background-color: #ffe6e9; }   /* èµ¤ã¿ */
  .answer-color-1 { background-color: #e6f7d4; }   /* ç·‘ç³» */
  .answer-color-2 { background-color: #d9ecff; }   /* é’ç³» */
  .answer-color-3 { background-color: #fff2cc; }   /* é»„ç³» */
  .answer-color-4 { background-color: #f0e6ff; }   /* ç´«ç³» */

  .answer-badge {
    display: inline-block;
    padding: 0.35em 0.7em;
    margin: 0.15em;
    border-radius: 0.75em;
    font-size: 0.85em;
    font-weight: 500;
    color: #333;
    white-space: nowrap;
  }

  .highlight-row {
    background-color: #d4edda !important;
    font-weight: bold;
    border-top: 2px solid #28a745;
  }

  /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
  @media (max-width: 768px) {
    .answer-table {
      font-size: 0.9em;
    }

    .section-title {
      font-size: 1.2rem;
    }
  }
</style>

<!-- ä»¥ä¸‹ã€HTMLï¼ˆæ§‹é€ ã¯ãã®ã¾ã¾ã§OKï¼‰ -->
<!-- ğŸ“… å‚åŠ å¯èƒ½æ—¥ã”ã¨ã®å‚åŠ è€… -->
<div class="result-card">
  <div class="section-title">ğŸ“… å‚åŠ å¯èƒ½æ—¥ã”ã¨ã®å‚åŠ è€…</div>
  <table class="answer-table">
    <thead>
      <tr>
        <th>æ—¥ä»˜</th>
        <th>å‚åŠ è€…æ•°</th>
        <th>å‚åŠ è€…å</th>
      </tr>
    </thead>
    <tbody>
      {% for date in available_dates %}
        <tr>
          <td>{{ date }}</td>
          <td>{{ date_participants.get(date, []) | length }}</td>
          <td>
            {% set participants = date_participants.get(date, []) %}
            {% if participants %}
              {{ participants | join(', ') }}
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ğŸ§â€â™‚ï¸ å‚åŠ è€…ã”ã¨ã®è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
<div class="result-card">
  <div class="section-title">ğŸ§â€â™‚ï¸ å‚åŠ è€…ã”ã¨ã®å›ç­”è©³ç´°</div>
  <table class="answer-table">
    <thead>
      <tr>
        <th>å‚åŠ è€…å</th>
        <th>å‚åŠ å¯èƒ½æ—¥</th>
        {% for q in questions %}
          <th>{{ q.text }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for p in participant_answers %}
        <tr>
          <td><strong>{{ p.name }}</strong></td>
          <td>{{ p.selected_dates | join(', ') }}</td>
          {% for q in questions %}
            {% set answer = p.answers.get(q.id) %}
            {% if answer %}
              {% if q.type == 'radio' %}
                {% set options = q.options | map(attribute='text') | list %}
                {% set idx = options.index(answer) if answer in options else -1 %}
                <td>
                  <span class="answer-badge answer-color-{{ idx if idx >= 0 else 0 }}">{{ answer }}</span>
                </td>
              {% elif q.type == 'checkbox' %}
                {% set options = q.options | map(attribute='text') | list %}
                {% set answer_list = answer.split(',') %}
                <td>
                  {% for ans in answer_list %}
                    {% set idx = options.index(ans.strip()) if ans.strip() in options else -1 %}
                    <span class="answer-badge answer-color-{{ idx if idx >= 0 else 0 }}">{{ ans.strip() }}</span>
                  {% endfor %}
                </td>
              {% else %}
                <td>{{ answer }}</td>
              {% endif %}
            {% else %}
              <td>-</td>
            {% endif %}
          {% endfor %}
        </tr>
      {% endfor %}

      <!-- æœ€çµ‚è¡Œï¼šæœ€å¤šæŠ•ç¥¨ -->
      <tr class="highlight-row">
        <td>æœ€å¤šæŠ•ç¥¨</td>
        <td>{{ most_selected_dates | join(', ') }}</td>
        {% for q in questions %}
          {% if q.type == 'radio' or q.type == 'checkbox' %}
            {% set most_answers = question_most_answers.get(q.id, []) %}
            {% if most_answers %}
              {% set options = q.options | map(attribute='text') | list %}
              <td>
                {% for ans in most_answers %}
                  {% set idx = options.index(ans) if ans in options else -1 %}
                  <span class="answer-badge answer-color-{{ idx if idx >= 0 else 0 }}">{{ ans }}</span>
                {% endfor %}
              </td>
            {% else %}
              <td>-</td>
            {% endif %}
          {% else %}
            <td>-</td>
          {% endif %}
        {% endfor %}
      </tr>
    </tbody>
  </table>
</div>
